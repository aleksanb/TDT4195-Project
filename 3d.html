<!DOCTYPE html>
<title>Display skittles</title>
<script src='//cdnjs.cloudflare.com/ajax/libs/three.js/r61/three.min.js'></script>
<script src='helvetiker_bold.js'></script>
<body>
<script>
var camera, scene, renderer;
var geometry, material, cube;
var skittles = {
    height: 316,
    width: 600,
    groups: [
        {
            color: 0xcc0000,
            elements: [
                {
                    y: 316 * Math.random(),
                    x: 600 * Math.random()
                },
                {
                    y: 316 * Math.random(),
                    x: 600 * Math.random()
                },
                {
                    y: 316 * Math.random(),
                    x: 600 * Math.random()
                }
            ]
        },
        {
            color: 0xffff00,
            elements: [
                {
                    y: 316 * Math.random(),
                    x: 600 * Math.random()
                },
                {
                    y: 316 * Math.random(),
                    x: 600 * Math.random()
                }
            ]
        }
    ]
};

function loadImage(path) {
  var img = new Image();
  img.onload = function() {
      init(skittles);
  };
  img.src = path;
  return img;
}

function init(skittles) {
    renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    /*factor = 3;
    camera = new THREE.OrthographicCamera(-window.innerWidth / factor, window.innerWidth / factor, window.innerHeight / factor, -window.innerHeight / factor, 1, 1000);*/
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
    camera.position.z = skittles.height * 1;
    camera.position.x = skittles.width / 2;
    camera.position.y = skittles.height / 2;

    scene = new THREE.Scene();

    // Add background image
    var canvas = document.createElement('canvas');
    canvas.width = skittles.width;
    canvas.height = skittles.height;
    var ctx = canvas.getContext('2d');
    ctx.drawImage(backgroundImage, 0, 0);
    var texture = new THREE.Texture(canvas);
    texture.needsUpdate = true;

    // Create background box
    background = new THREE.PlaneGeometry(skittles.width, skittles.height);
    backgroundMaterial = new THREE.MeshBasicMaterial( { map: texture } );
    var boundingBox = new THREE.Mesh( background, backgroundMaterial );

    boundingBox.position.x = skittles.width / 2;
    boundingBox.position.y = skittles.height / 2;

    scene.add(boundingBox);

    cubes = [];
    counts = [];

    skittles.groups.forEach(function(group) {
        group.elements.forEach(function(element) {
            // Create sphere
            geometry = new THREE.SphereGeometry(20, 20, 20);
            material = new THREE.MeshLambertMaterial({ color: group.color });
            cube = new THREE.Mesh(geometry, material);

            // Position sphere
            cube.position.x = element.x;
            cube.position.y = element.y;
            cube.position.z = 0;   

            // Add sphere
            cubes.push(cube);
            scene.add(cube);

            // Create number
            var text3d = new THREE.TextGeometry( group.elements.length, {
                size: 30,
                height: 4,
                font: "helvetiker",
                weight: "bold",
                style: "normal",
                bevelEnabled: true,
                bevelThickness: 5,
                bevelSize: 1
            });

            var textMesh = new THREE.Mesh( text3d, material );

            // Position number
            textMesh.position.x = element.x;
            textMesh.position.y = element.y + cube.geometry.radius * 1.1;

            // Add number
            cube.textMesh = textMesh;
            counts.push(textMesh);
            scene.add(textMesh);
        });
    });

    var light = new THREE.PointLight(0xffffff);
    light.position = new THREE.Vector3(0,100,400);
    scene.add(light);

    animate();
}

function animate() {
    requestAnimationFrame(animate);

    var t = Date.now();

    cubes.forEach(function(cube) {
        cube.textMesh.rotation.y = t / 1000;
    });

    renderer.render(scene, camera);
}

backgroundImage = loadImage('img/sweetsA01.png');

</script>